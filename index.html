<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TODO„Ç¢„Éó„É™</title>
  <style>
    body {
      font-family: "Hiragino Maru Gothic ProN", "Arial", sans-serif;
      background: #fff4f4;
      padding: 40px;
      text-align: center;
    }
    
    h1 {
      color: #ff69b4;
      font-size: 2.2em;
      margin-bottom: 20px;
      text-shadow: 1px 1px 2px #ffa5d8;
    }
    
    input[type="text"] {
      padding: 12px;
      width: 240px;
      font-size: 16px;
      border: 2px solid #ffb6c1;
      border-radius: 8px;
      outline: none;
      background-color: #fff0f5;
    }
    
    button {
      padding: 10px 20px;
      font-size: 16px;
      margin-left: 10px;
      cursor: pointer;
      border: none;
      border-radius: 8px;
      background-color: #ff69b4;
      color: white;
      transition: background-color 0.3s ease;
    }
    
    button:hover {
      background-color: #ff85c1;
    }
    
    ul {
      list-style: none;
      padding: 0;
      margin-top: 30px;
    }
    
    li {
      background: #ffe4e1;
      padding: 12px;
      margin-bottom: 10px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(255, 105, 180, 0.2);
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 16px;
    }
    
    li button {
      background: #ff6b6b;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 14px;
      transition: background-color 0.3s ease;
    }
    
    li button:hover {
      background: #ff8888;
    }
    
    @keyframes fadeInUp {
      0% {
        opacity: 0;
        transform: translateY(20px);
      }
      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    li.animate {
      animation: fadeInUp 0.4s ease-out;
    }
    
    li.checked span {
      text-decoration: line-through;
      color: #aaa;
      opacity: 0.6;
    }
    
    li input[type="checkbox"] {
      margin-right: 10px;
      transform: scale(1.2);
    }
    
    #downloadCSV {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 10px 16px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 999px;
      font-size: 14px;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      transition: transform 0.2s ease;
    }
    
    #downloadCSV:hover {
      transform: scale(1.05);
      background-color: #45a049;
    }


  </style>
</head>
<body>
  <h1>ÁßÅ„ÅÆTODO„É™„Çπ„Éà</h1>
  <button id="downloadCSV">CSV„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ</button>
  <input type="text" id="todoInput" placeholder="„ÇÑ„Çã„Åì„Å®„ÇíÂÖ•Âäõ" />
  <button onclick="addTodo()">ËøΩÂä†</button>
  <button id="pasteButton">„Éö„Éº„Çπ„Éà</button>
  <button id="clearAllButton">ÂÖ®ÂâäÈô§</button>
  <ul id="todoList">
    <!-- TODO„Åå„Åì„Åì„Å´ËøΩÂä†„Åï„Çå„Çã -->
  </ul>

  <script>
    function addTodo() {
        const input = document.getElementById("todoInput");
        const text = input.value;
        if (text === "") return;

        createTodoItem(text); // ‚Üê Êñ∞„Åó„ÅÑ„Ç¢„Ç§„ÉÜ„É†„Çí‰ΩúÊàê
        saveTodos();          // ‚Üê ‰øùÂ≠òÔºÅ

        input.value = "";
    }
    function saveTodos() {
        const todos = [];
        document.querySelectorAll("#todoList li").forEach((li) => {
            const checkbox = li.querySelector("input[type='checkbox']");
            const text = li.querySelector("span").textContent;
            todos.push({ text, done: checkbox.checked });
        });
        localStorage.setItem("todos", JSON.stringify(todos));
    }

    function loadTodos() {
        const todos = JSON.parse(localStorage.getItem("todos") || "[]");
        todos.forEach((todo) => {
            createTodoItem(todo.text, todo.done);
        });
    }

    function createTodoItem(text, done = false) {
        const li = document.createElement("li");
        li.classList.add("animate");

        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.checked = done;
        checkbox.onchange = () => {
            li.classList.toggle("checked", checkbox.checked);
            saveTodos(); // ‚úÖ Áä∂ÊÖã„ÅåÂ§â„Çè„Å£„Åü„Çâ‰øùÂ≠ò
        };

        const span = document.createElement("span");
        span.textContent = text;

        const deleteBtn = document.createElement("button");
        deleteBtn.textContent = "ÂâäÈô§";
        deleteBtn.onclick = () => {
            li.remove();
            saveTodos(); // ‚úÖ ÂâäÈô§„Åó„Åü„Çâ‰øùÂ≠ò
        };

        li.appendChild(checkbox);
        li.appendChild(span);
        li.appendChild(deleteBtn);

        if (done) li.classList.add("checked");

        document.getElementById("todoList").appendChild(li);
    }
    window.onload = () => {
        loadTodos();
    };
    document.getElementById("pasteButton").addEventListener("click", () => {
    navigator.clipboard.readText().then((text) => {
      if (text.trim()) {
        createTodoItem(text);  // TODO„Å®„Åó„Å¶ËøΩÂä†ÔºÅ
        saveTodos();
      } else {
        alert("„ÇØ„É™„ÉÉ„Éó„Éú„Éº„Éâ„Å´„ÉÜ„Ç≠„Çπ„Éà„Åå„ÅÇ„Çä„Åæ„Åõ„Çì");
      }
    }).catch((err) => {
      alert("„Éö„Éº„Çπ„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„ÅüÔºö" + err);
    });
  });

  document.getElementById("clearAllButton").addEventListener("click", () => {
  if (confirm("Êú¨ÂΩì„Å´„Åô„Åπ„Å¶ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü")) {
    document.getElementById("todoList").innerHTML = ""; // „É™„Çπ„Éà„ÇíÁ©∫„Å´
    localStorage.removeItem("todos"); // localStorage„Åã„Çâ„ÇÇÂâäÈô§
  }
  });

  document.getElementById("downloadCSV").addEventListener("click", () => {
  // 1. localStorage„Åã„ÇâTODO„ÇíÂèñÂæó
  const todos = JSON.parse(localStorage.getItem("todos") || "[]");

  // üîí „É™„Çπ„Éà„ÅåÁ©∫„Å™„Çâ‰∏≠Ê≠¢ÔºÜ„Ç¢„É©„Éº„Éà
  if (todos.length === 0) {
    alert("TODO„É™„Çπ„Éà„ÅåÁ©∫„Åß„Åô„ÄÇCSV„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åß„Åç„Åæ„Åõ„Çì„ÄÇ");
    return;
  }
  
  // 2. CSVÂΩ¢Âºè„ÅÆÊñáÂ≠óÂàó„Çí‰ΩúÊàê
  let csv = "„Çø„Çπ„ÇØ,ÂÆå‰∫Ü\n";
  todos.forEach(todo => {
    const escapedTask = `"${todo.text.replace(/"/g, '""')}"`; // „ÉÄ„Éñ„É´„ÇØ„Ç™„Éº„ÉàÂØæÁ≠ñ
    csv += `${escapedTask},${todo.done}\n`;
  });

  // 3. Blob„ÅßCSV„Éï„Ç°„Ç§„É´„Çí‰Ωú„Çã
  const blob = new Blob([csv], { type: "text/csv" });
  const url = URL.createObjectURL(blob);

  // 4. „ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„É™„É≥„ÇØ„Çí‰Ωú„Å£„Å¶Ëá™Âãï„ÇØ„É™„ÉÉ„ÇØ
  const a = document.createElement("a");
  a.href = url;
  a.download = "todo.csv";
  a.click();

  // 5. ÂæåÂßãÊú´
  URL.revokeObjectURL(url);
});

  </script>
</body>
</html>
